<html>
    <head>

        <script type = "text/javascript" 
         src = "{{ url_for('static', filename = 'diff.js') }}" ></script>
         <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
         <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
         <meta name="viewport" content="width=320, initial-scale=1" />

    </head>
    <body>
        <nav>
            <h1>Capitol Differ</h1>
            <button onclick="location.href = 'https://capitoldiffer.com//about';" >
                <strong>About</strong>
            </button>
        </nav>
        <article class="grid-container">
            <div class = "text_box_padding">
                <h3>Select Congresses to compare</h3>

                <select name="congress_1" id="congress_1" class = "selectors" onchange="changeInCongress()">
                    {% for c in Congress_List %}
                        <option value={{c}}>{{c + " Congress"}}</option>
                    {% endfor %}
                </select>


                <select name="congress_2" id="congress_2" class = "selectors" onchange="changeInCongress()">
                    {% for c in Congress_List %}
                        <option value={{c}}>{{c + " Congress"}}</option>
                    {% endfor %}
                </select>

            </div>
            <div id="statistics">
                <div>
                    <h3>Leadership and Party Control for <span id="speaker_now_header"> 117th</span> Congress </h3>
                    <p>Speaker in the <span id="current_congress">117th</span> Congress: <span id="speaker_now">Nancy Pelosi</span></p>
                    <p>Majority Party in the <span id="current_congress_2">117th</span> Congress: <span id="current_party">Democratic</span></p>
                </div>
                <div>
                    <h3>Leadership and Party Control for <span id="speaker_then_header"> 117th </span> Congress </h3>
                    <p>Speaker in the: <span id="previous_congress">117th</span> Congress: <span id="speaker_then"></span></p>
                    <p>Majority Party in the <span id="previous_congress_2">117th</span> Congress: <span id="previous_party"></span></p>
                    <p>Party Change: <span id="party_change"></span></p>
                </div>

        
            </div>

            <div class = "text_box_padding rules_box">
                <h3>Select rule to compare</h3>

            </div>
        
        </article>

        <article class = "grid-container-other-article">

            <button onclick="generateDiff()" class="button">Compare</button>

        </article>
        <article class = "grid-container-other-article">
            <h3>The difference between the rules</h3>
            <p id="diff_text"></p>

            <h3>Legend</h3>
            <p style="color: green; font-weight: 900;">This is text that was added.</p>
            <p style="color: red; text-decoration: line-through;">This is text that was removed.</p>
            </body>

            <h3>The rule for the <span id="rule_change_first_congress"></span> Congress</h3>
            <p id="old_text"></p>

            <h3>The rule for the <span id="rule_change_second_congress"></span> Congress</h3>
            <p id="new_text"></p>

        </article>

        <script>

            const nested_rules = {
                "RULE I. THE SPEAKER":[
      "Approval of the Journal",
      "Preservation of order",
      "Control of Capitol facilities",
      "Signature of documents",
      "Questions of order",
      "Form of a question",
      "Discretion to vote",
      "Speaker pro tempore",
      "Other responsibilities",
      "Designation of travel",
      "Committee appointment",
      "Recess and Convening Authorities",
      "Term limit",
      "Declaration of recess",
      "Journal; Speaker's approval.",
      "Speaker preserves order on floor in galleries and lobby",
      "Speaker's control of the Hall, corridors, and rooms",
      "Speaker's signature to acts, warrants, subpoenas, etc.; and decision of questions of order subject to appeal",
      "Putting of the question by the Speaker.",
      "Voting viva voce, by division, by electronic device",
      "Postponing rollcall votes on passage.",
      "Speaker pro tempore.",
      "Four-term limit.",
      "Travel authority.",
      "Broadcasting of House proceedings.",
      "Office of the Historian.",
      "Office of General Counsel.",
      "Authority to declare recesses.",
      "Drug testing in the House.",
      "Full Rule for: THE SPEAKER"
   ],
   "II. OTHER OFFICERS AND OFFICIALS":[
      "Elections",
      "Clerk",
      "Sergeant-at-Arms",
      "Chief Administrative Officer",
      "Chaplain",
      "Office of Inspector General",
      "Office of the Historian",
      "Office of General Counsel",
      "Office of Diversity and Inclusion",
      "Office of the Whistleblower Ombuds",
      "Full Rule for: OTHER OFFICERS AND OFFICIALS"
   ],
   "III. THE MEMBERS, DELEGATES, AND RESIDENT COMMISSIONER OF PUERTO RICO":[
      "Voting",
      "Delegates and the Resident Commissioner",
      "Full Rule for: THE MEMBERS, DELEGATES, AND RESIDENT COMMISSIONER OF PUERTO RICO"
   ],
   "IV. HALL OF THE HOUSE.":[
      "Use of the Hall of the House.",
      "Full Rule for: HALL OF THE HOUSE."
   ],
   "V. BROADCASTING THE HOUSE":[
      "BROADCASTING THE HOUSE",
      "Full Rule for: BROADCASTING THE HOUSE"
   ],
   "VI. OFFICIAL REPORTERS AND NEWS MEDIA GALLERIES":[
      "Official reporters",
      "News media galleries",
      "Full Rule for: OFFICIAL REPORTERS AND NEWS MEDIA GALLERIES"
   ],
   "VII. RECORDS OF THE HOUSE":[
      "Archiving",
      "Public availability",
      "Definition of record",
      "Withdrawal of papers",
      "Full Rule for: RECORDS OF THE HOUSE"
   ],
   "VIII. RESPONSE TO SUBPOENAS":[
      "RESPONSE TO SUBPOENAS",
      "Full Rule for: RESPONSE TO SUBPOENAS"
   ],
   "IX. QUESTIONS OF PRIVILEGE":[
      "QUESTIONS OF PRIVILEGE",
      "Definition of questions of privilege.",
      "Precedence of questions of privilege.",
      "Full Rule for: QUESTIONS OF PRIVILEGE"
   ],
   "X. ORGANIZATION OF COMMITTEES":[
      "Committees and their legislative jurisdictions",
      "Committee on Agriculture",
      "Committee on Appropriations",
      "Committee on Armed Services",
      "Committee on the Budget",
      "Committee on Education and Labor",
      "Committee on Energy and Commerce",
      "Committee on Ethics",
      "Committee on Financial Services",
      "Committee on Foreign Affairs",
      "Committee on Homeland Security",
      "Committee on House Administration",
      "Committee on Natural Resources",
      "Committee on Oversight and Reform",
      "Committee on Rules",
      "Committee on Science, Space, and Technology",
      "Committee on Small Business",
      "Committee on Transportation and Infrastructure",
      "Committee on Veteransâ€™ Affairs",
      "Committee on Ways and Means",
      "General oversight responsibilities",
      "Special oversight functions",
      "Additional functions of committees",
      "Budget Act responsibilities",
      "Election and membership of standing committees",
      "Expense resolutions",
      "Interim funding",
      "Travel",
      "Committee staffs",
      "Select and joint committees",
      "Permanent Select Committee on Intelligence",
      "Committee on the Judiciary",
      "Committee on Standards of Official Conduct",
      "Committees and their legislative jurisdiction",
      "Full Rule for: ORGANIZATION OF COMMITTEES"
   ],
   "XI. PROCEDURES OF COMMITTEES AND UNFINISHED BUSINESS":[
      "In general",
      "Adoption of written rules",
      "Regular meeting days",
      "Additional and special meetings",
      "Temporary absence of chair",
      "Committee records",
      "Prohibition against proxy voting",
      "Open meetings and hearings",
      "Quorum requirements",
      "Limitation on committee sittings",
      "Calling and questioning of witnesses",
      "Hearing procedures",
      "Supplemental, minority, additional, or dissenting views",
      "Power to sit and act; subpoena power",
      "Committee on Ethics",
      "Committee agendas",
      "Committee staff",
      "Meetings and hearings",
      "Public disclosure",
      "Requirements to constitute a complaint",
      "Duties of chair and ranking minority member regarding properly filed complaints",
      "Duties of chair and ranking minority member regarding information not constituting a complaint",
      "Investigative and adjudicatory subcommittees",
      "Standard of proof for adoption of statement of alleged violation",
      "Subcommittee powers",
      "Due process rights of respondents",
      "Committee reporting requirements",
      "Audio and visual coverage of committee proceedings",
      "Pay of witnesses",
      "Unfinished business of the session",
      "Supplemental, minority, or additional views",
      "Committee on Standards of Official Conduct",
      "Temporary absence of chairman",
      "Duties of chairman and ranking minority member regarding properly filed complaints",
      "Duties of chairman and ranking minority member regarding information not constituting a complaint",
      "Due process rights of respondents and witnesses",
      "Committee reporting requirement",
      "Investigative hearing procedures",
      "Full Rule for: PROCEDURES OF COMMITTEES AND UNFINISHED BUSINESS"
   ],
   "XII. RECEIPT AND REFERRAL OF MEASURES AND MATTERS":[
      "Messages",
      "Referral",
      "Petitions, memorials, and private bills",
      "Prohibition on commemorations",
      "Excluded matters",
      "Sponsorship",
      "Executive communications",
      "Petitions, memorials, and private bill",
      "Full Rule for: RECEIPT AND REFERRAL OF MEASURES AND MATTERS"
   ],
   "XIII. CALENDARS AND COMMITTEE REPORTS":[
      "Calendars",
      "Filing and printing of reports",
      "Content of reports",
      "Availability of reports",
      "Privileged reports, generally",
      "Privileged reports by the Committee on Rules",
      "Resolutions of inquiry",
      "Estimates of major legislation",
      "Full Rule for: CALENDARS AND COMMITTEE REPORTS"
   ],
   "XIV. ORDER AND PRIORITY OF BUSINESS":[
      "ORDER AND PRIORITY OF BUSINESS",
      "Full Rule for: ORDER AND PRIORITY OF BUSINESS"
   ],
   "XV. BUSINESS IN ORDER ON SPECIAL DAYS":[
      "Suspensions",
      "Discharge motions",
      "Adverse report by the Committee on Rules, second and fourth Mondays",
      "Private Calendar",
      "Calendar Call of Committees, Wednesdays",
      "Consensus Calendar",
      "District of Columbia business, second and fourth Mondays",
      "Discharge motions, second and fourth Mondays",
      "Private Calendar, first and third Tuesdays",
      "Suspensions, Mondays and Tuesdays",
      "Corrections Calendar, second and fourth Tuesdays",
      "Full Rule for: BUSINESS IN ORDER ON SPECIAL DAYS"
   ],
   "XVI. MOTIONS AND AMENDMENTS":[
      "Motions",
      "Withdrawal",
      "Question of consideration",
      "Precedence of motions",
      "Divisibility",
      "Amendments",
      "Germaneness",
      "Readings",
      "Full Rule for: MOTIONS AND AMENDMENTS"
   ],
   "XVII. DECORUM AND DEBATE":[
      "Decorum",
      "Recognition",
      "Managing debate",
      "Call to order",
      "Comportment",
      "Exhibits",
      "Galleries",
      "Congressional Record",
      "Legislative Proceedings",
      "Secret sessions",
      "Full Rule for: DECORUM AND DEBATE"
   ],
   "XVIII. THE COMMITTEE OF THE WHOLE HOUSE ON THE STATE OF THE UNION":[
      "Resolving into the Committee of the Whole",
      "Measures requiring initial consideration in the Committee of the Whole",
      "Order of business",
      "Reading for amendment",
      "Quorum and voting",
      "Dispensing with the reading of an amendment",
      "Closing debate",
      "Striking the enacting clause",
      "Concurrent resolution on the budget",
      "Applicability of Rules of the House",
      "Unfunded mandates",
      "Full Rule for: THE COMMITTEE OF THE WHOLE HOUSE ON THE STATE OF THE UNION"
   ],
   "XIX. MOTIONS FOLLOWING THE AMENDMENT STAGE":[
      "Previous question",
      "Recommit",
      "Reconsideration",
      "Full Rule for: MOTIONS FOLLOWING THE AMENDMENT STAGE"
   ],
   "XX. VOTING AND QUORUM CALLS":[
      "VOTING AND QUORUM CALLS",
      "Postponement of proceedings",
      "Five-minute votes",
      "Automatic yeas and nays",
      "Ballot votes",
      "Postponement of proceeding",
      "Full Rule for: VOTING AND QUORUM CALLS"
   ],
   "XXI. RESTRICTIONS ON CERTAIN BILLS":[
      "Reservation of certain points of order",
      "General appropriation bills and amendments",
      "Appropriations on legislative bills",
      "Tax and tariff measures and amendments",
      "Consideration of retroactive tax rate increases",
      "Designation of public works",
      "Passage of tax rate increases",
      "Transportation obligation limitations",
      "Full Rule for: RESTRICTIONS ON CERTAIN BILLS"
   ],
   "XXII. HOUSE AND SENATE RELATIONS":[
      "Senate amendments",
      "Conference reports; amendments reported in disagreement",
      "Full Rule for: HOUSE AND SENATE RELATIONS"
   ],
   "XXIII. CODE OF OFFICIAL CONDUCT":[
      "CODE OF OFFICIAL CONDUCT",
      "Full Rule for: CODE OF OFFICIAL CONDUCT"
   ],
   "XXIV. LIMITATIONS ON USE OF OFFICIAL FUNDS":[
      "Limitations on use of official and unofficial accounts",
      "Limitations on use of the frank",
      "Prohibition on use of funds by Members not elected to succeeding Congress",
      "Full Rule for: LIMITATIONS ON USE OF OFFICIAL FUNDS"
   ],
   "XXV. LIMITATIONS ON OUTSIDE EARNED INCOME AND ACCEPTANCE OF GIFTS":[
      "Outside earned income; honoraria",
      "Copyright royalties",
      "Definitions",
      "Gifts",
      "Claims against the Government",
      "Full Rule for: LIMITATIONS ON OUTSIDE EARNED INCOME AND ACCEPTANCE OF GIFTS"
   ],
   "XXVI. FINANCIAL DISCLOSURE":[
      "FINANCIAL DISCLOSURE",
      "Persons Required to File",
      "Contents of Reports",
      "Filing of Reports",
      "Failure to File or Filing False Reports",
      "Custody of and Public Access to Reports",
      "Review of Reports",
      "Confidential Reports and Other Additional Requirements",
      "Authority of Comptroller General",
      "Definitions",
      "Notice of Actions Taken to Comply with Ethics Agreements",
      "Administration of Provisions",
      "Custody of and Public",
      "Administration of Provision",
      "Financial report disclosing certain financial interests.",
      "Full Rule for: FINANCIAL DISCLOSURE"
   ],
   "XXVII. DISCLOSURE BY MEMBERS AND STAFF OF EMPLOYMENT NEGOTIATIONS":[
      "DISCLOSURE BY MEMBERS AND STAFF OF EMPLOYMENT NEGOTIATIONS",
      "Full Rule for: DISCLOSURE BY MEMBERS AND STAFF OF EMPLOYMENT NEGOTIATIONS"
   ],
   "XXVIII. STATUTORY LIMIT ON THE PUBLIC DEBT":[
      "STATUTORY LIMIT ON THE PUBLIC DEBT",
      "Full Rule for: STATUTORY LIMIT ON THE PUBLIC DEBT"
   ],
   "XXIX. GENERAL PROVISIONS":[
      "GENERAL PROVISIONS",
      "Full Rule for: GENERAL PROVISIONS"
   ]
}

            const select_nested = document.createElement("select");
            select_nested.setAttribute('id', 'rule_selector');


            // loop through the optgroups and add them to the <select> element
            for (var groupName in nested_rules) {
            // create the optgroup
            var optgroup = document.createElement("optgroup");
            optgroup.label = groupName;

            // loop through the options in the optgroup and add them to the optgroup
            for (var i = 0; i < nested_rules[groupName].length; i++) {
                var option = document.createElement("option");
                option.value = nested_rules[groupName][i];
                option.text = nested_rules[groupName][i];
                optgroup.appendChild(option);
            }

            // add the optgroup to the <select> element
                select_nested.appendChild(optgroup);
            }
            
            document.querySelector(".rules_box").appendChild(select_nested)
                        
            
            function changeInCongress(){

                const congresses_with_party = [
                {Congress: "117th", Party: "Democratic", Speaker: "Nancy Pelosi"},
                {Congress: "116th", Party: "Democratic", Speaker: "Nancy Pelosi"},
                {Congress: "115th", Party: "Republican", Speaker: "Paul Ryan"},
                {Congress: "114th", Party: "Republican", Speaker: "Paul Ryan"},
                {Congress: "113th", Party: "Republican", Speaker: "John Boehner"},
                {Congress: "112th", Party: "Republican", Speaker: "John Boehner"},
                {Congress: "111th", Party: "Democratic", Speaker: "Nancy Pelosi"},
                {Congress: "110th", Party: "Democratic", Speaker: "Nancy Pelosi"},
                {Congress: "109th", Party: "Republican", Speaker: "John Dennis Hastert"},
                {Congress: "108th", Party: "Republican", Speaker: "John Dennis Hastert"},
                {Congress: "107th", Party: "Republican", Speaker: "John Dennis Hastert"},
                {Congress: "106th", Party: "Republican", Speaker: "John Dennis Hastert"},
                {Congress: "105th", Party: "Republican", Speaker: "Newt Gingrich"},
                    ]

                first_year = document.getElementById('congress_1')
                second_year = document.getElementById('congress_2')
                

                let congress_first = congresses_with_party.filter(d => d.Congress == first_year.value)[0]
                let congress_second = congresses_with_party.filter(d => d.Congress == second_year.value)[0]
                console.log(`${congress_first.Party} to ${congress_second.Party}` )

                let congress_first_int = parseInt(congress_first.Congress.replace("th", ""))
                let congress_second_int = parseInt(congress_second.Congress.replace("th", ""))

                if (congress_first_int > congress_second_int){
                    
                    let party_change_element = document.getElementById("party_change")
                    
                    if(congress_second.Party === congress_first.Party){
                        party_change_element.innerHTML = `No. ${congress_second.Party} to ${congress_first.Party}`;
                    } else {
                        party_change_element.innerHTML = `Yes. ${congress_second.Party} to ${congress_first.Party}`;
                    }


                } else {
                    let party_change_element = document.getElementById("party_change")

                    if(congress_second.Party === congress_first.Party){ 
                        party_change_element.innerHTML = `No. ${congress_first.Party} to ${congress_second.Party}`;
                    } else {
                        party_change_element.innerHTML = `Yes. ${congress_first.Party} to ${congress_second.Party}`;
                    }

                }

                let speaker_now_element = document.getElementById("speaker_now")
                let speaker_then_element = document.getElementById("speaker_then")

                speaker_now_element.innerHTML = congress_first.Speaker
                speaker_then_element.innerHTML = congress_second.Speaker

                let speaker_now_header_element = document.getElementById("speaker_now_header")
                let speaker_then_header_element = document.getElementById("speaker_then_header")

                speaker_now_header_element.innerHTML = congress_first.Congress
                speaker_then_header_element.innerHTML = congress_second.Congress

                let rule_change_first_congress_element = document.getElementById("rule_change_first_congress")
                let rule_change_second_congress_element = document.getElementById("rule_change_second_congress")

                rule_change_first_congress_element.innerHTML = congress_first.Congress
                rule_change_second_congress_element.innerHTML = congress_second.Congress


                // Updating the first cell
                document.getElementById("current_congress").innerHTML = first_year.value
                document.getElementById("current_congress_2").innerHTML = first_year.value
                document.getElementById("current_party").innerHTML = congress_first.Party

                // Updating the second cell
                document.getElementById("previous_congress").innerHTML = second_year.value
                document.getElementById("previous_congress_2").innerHTML = second_year.value
                document.getElementById("previous_party").innerHTML = congress_second.Party


            }
    
            async function generateDiff(){
                first_year = document.getElementById('congress_2')
                second_year = document.getElementById('congress_1')
                
                first_rule = document.getElementById('rules_1')
                first_rule_new = document.getElementById("rule_selector").value

                if (first_year.value !== second_year.value){
                
                    res_1 = await fetch(`/api?congress=${first_year.value}&title=${first_rule_new}`)          
                    res_2 = await fetch(`/api?congress=${second_year.value}&title=${first_rule_new}`)

                    if (res_1.status === 200 && res_2.status === 200){

                    obj_1 = await res_1.json();
                    obj_2 = await res_2.json();


                    console.log(obj_1)
                    console.log(obj_2)

                    document.getElementById("new_text").innerHTML = obj_1.Result
                    document.getElementById("old_text").innerHTML = obj_2.Result

                    const diff = JsDiff.diffWordsWithSpace(obj_1.Result, obj_2.Result)

                    const display = document.getElementById('diff_text');
                    display.innerHTML = '';
                    const fragment = document.createDocumentFragment();
                    diff.forEach((part) => {
                        // green for additions, red for deletions
                        // grey for common parts

                        // bold for new. Strike out for old

                        console.log(part.added)
                        console.log(part.removed)

                        const size = part.added ? '900' : '400' // style.fontWeight
                        const underline = part.removed ? 'line-through': 'none'  // style.textDecoration

                        const color = part.added ? 'green' :
                            part.removed ? 'red' : 'grey';

                        span = document.createElement('span');
                        span.style.color = color;
                        span.style.fontWeight = size;
                        span.style.textDecoration = underline;
                        span.appendChild(document
                            .createTextNode(part.value));
                        fragment.appendChild(span);
                    });

                    display.appendChild(fragment);
                } else {
                    alert("Rule does not exist in both years. Try different years")
                }
            } else {
                alert("Congresses are the same years. Pick a different Congresses.")
            }

        }

            
                 
                
            

        </script>
</html>