<html>
    <head>

        <script type = "text/javascript" 
         src = "{{ url_for('static', filename = 'diff.js') }}" ></script>
         <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">

    </head>
    <body>
        <h1>House Rules Differ</h1>
        <article class="grid-container">
            <div>
                <h4>Congresses</h4>

                <label for="cars">Select the first Congress</label>

                <select name="congress_1" id="congress_1" class = "selectors">
                    {% for c in Congress_List %}
                        <option value={{c}}>{{c}}</option>
                    {% endfor %}
                </select>

                <label for="cars">Select the second Congress</label>

                <select name="congress_2" id="congress_2" class = "selectors" onchange="changeInCongress()">
                    {% for c in Congress_List %}
                        <option value={{c}}>{{c}}</option>
                    {% endfor %}
                </select>

            </div>
            <div>
            <h4>Rules</h4>


                <label for="cars">Select the first Rule</label>

                <select name="rules_1" id="rules_1" class = "selectors">
                    {% for t in Titles_List %}
                        <option value="{{t}}">{{t}}</option>
                    {% endfor %}
                </select>

                
        </div>

        <div>
            <h4>Statistics </h4>
            <p>Speaker Now: <span id="speaker_now"></span></p>
            <p>Speaker Then: <span id="speaker_then"></span></p>
            <p>Current Party: <span id="current_party"></span></p>
            <p>Party Change: <span id="party_change"></span></p>
        </div>
        
        </article>

        <div>
            <button onclick="generateDiff()" class="button">Generate the diff</button>
        </div>

        <h3>The difference between the rules</h3>
        <p id="diff_text">

        </p>
        </body>
        <script>

            const congresses_with_party = [
                {Congress: "117th", Party: "Democratic", Speaker: "Nancy Pelosi"},
                {Congress: "116th", Party: "Democratic", Speaker: "Nancy Pelosi"},
                {Congress: "115th", Party: "Republican", Speaker: "Paul Ryan"},
                {Congress: "114th", Party: "Republican", Speaker: "Paul Ryan"},
                {Congress: "113th", Party: "Republican", Speaker: "John Boehner"},
                {Congress: "112th", Party: "Republican", Speaker: "John Boehner"},
                {Congress: "111th", Party: "Democratic", Speaker: "Nancy Pelosi"},
                {Congress: "110th", Party: "Democratic", Speaker: "Nancy Pelosi"},
                {Congress: "109th", Party: "Republican", Speaker: "John Hastert"},
            ]
            
            function changeInCongress(){
                first_year = document.getElementById('congress_1')
                second_year = document.getElementById('congress_2')
                
                console.log(first_year.value)
                console.log(second_year.value)

                let congress_first = congresses_with_party.filter(d => d.Congress == first_year.value)[0]
                let congress_second = congresses_with_party.filter(d => d.Congress == second_year.value)[0]

                console.log(`${congress_first.Party} to ${congress_second.Party}` )
                
                if (congress_first.Party !== congress_second.Party){
                    let party_change_element = document.getElementById("party_change")
                    party_change_element.innerHTML = `Yes. ${congress_first.Party} to ${congress_second.Party}`;
                } else {
                    let party_change_element = document.getElementById("party_change")
                    party_change_element.innerHTML = 'No';
                }

                let speaker_now_element = document.getElementById("speaker_now")
                let speaker_then_element = document.getElementById("speaker_then")

                speaker_now_element.innerHTML = congress_first.Speaker
                speaker_then_element.innerHTML = congress_second.Speaker

                let current_party_element = document.getElementById("current_party")
                current_party_element.innerHTML = congress_first.Party



            }
    
            async function generateDiff(){
                first_year = document.getElementById('congress_1')
                second_year = document.getElementById('congress_2')
                
                first_rule = document.getElementById('rules_1')

                if (first_year.value !== second_year.value){
                
                    res_1 = await fetch(`/api?congress=${first_year.value}&title=${first_rule.value}`)
                    obj_1 = await res_1.json();
                    
                    res_2 = await fetch(`/api?congress=${second_year.value}&title=${first_rule.value}`)
                    obj_2 = await res_2.json();

                    console.log(obj_1)
                    console.log(obj_2)

                    const diff = JsDiff.diffWordsWithSpace(obj_1.Result, obj_2.Result)

                    const display = document.getElementById('diff_text');
                    display.innerHTML = '';
                    const fragment = document.createDocumentFragment();
                    diff.forEach((part) => {
                        // green for additions, red for deletions
                        // grey for common parts

                        // bold for new. Strike out for old

                        console.log(part.added)
                        console.log(part.removed)

                        const size = part.added ? '900' : '400' // style.fontWeight
                        const underline = part.removed ? 'line-through': 'none'  // style.textDecoration

                        const color = part.added ? 'green' :
                            part.removed ? 'red' : 'grey';

                        span = document.createElement('span');
                        span.style.color = color;
                        span.style.fontWeight = size;
                        span.style.textDecoration = underline;
                        span.appendChild(document
                            .createTextNode(part.value));
                        fragment.appendChild(span);
                    });

                display.appendChild(fragment);
                }

            }
                 
                
            

        </script>
</html>